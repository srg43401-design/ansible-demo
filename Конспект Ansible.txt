	–ö–æ–Ω—Å–ø–µ–∫—Ç Ansible

	–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –º–æ–¥—É–ª–µ–π

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –ú–æ–¥—É–ª–∏ –≤ Ansible - —ç—Ç–æ –Ω–µ–±–æ–ª—å—à–∏–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–∞ —Ö–æ—Å—Ç–∞—Ö. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–±–∏—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏—Ö –≤—ã–∑–æ–≤–∞.

–ò—Å—Ç–æ—á–Ω–∏–∫–∏: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Ansible, –¥—Ä—É–≥–∏–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∑ Ansible Galaxy.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ HTTPD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å service, –≤ –∫–æ—Ç–æ—Ä—ã–π —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

–†–∞–±–æ—Ç–∞ —Å –º–æ–¥—É–ª—è–º–∏

–ü–æ–∏—Å–∫ –º–æ–¥—É–ª–µ–π:

–í –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å "Ansible module list" –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫—É –º–æ–¥—É–ª–µ–π.

–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ansible-doc, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–æ–¥—É–ª—è–º –≤ Vim-–ø–æ–¥–æ–±–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

–ò–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–±—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
–ó–∞—Ç–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–æ–º–∞–Ω–¥, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏.

–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

–í–∞–∂–Ω–æ –∏–∑—É—á–∏—Ç—å, –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥–∞—Ö –≤–Ω—É—Ç—Ä–∏ –ø–ª–µ–π–±—É–∫–∞.


______________________________________
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________

	9.8. Ad-hoc –∫–æ–º–∞–Ω–¥—ã

–ü–æ–ª–µ–∑–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤.
–ü—Ä–∏–º–µ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: docker run (—Ä–∞–∑–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ) –ø—Ä–æ—Ç–∏–≤ docker-compose (–æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤).

–û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.
–ù–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –ø–ª–µ–π–±—É–∫–æ–≤.
–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: –±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥.

–°–∏–Ω—Ç–∞–∫—Å–∏—Å:

–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ö–æ—Å—Ç–∞, –º–æ–¥—É–ª—è –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (ansible -i <–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å> -m <–º–æ–¥—É–ª—å> -a <–∞—Ä–≥—É–º–µ–Ω—Ç—ã>).

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–æ–¥—É–ª—å –∑–∞ –∫–æ–º–∞–Ω–¥—É.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

–°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥—É–ª—è User.
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (sudo).

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã Ansible:

–†–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥, –≤–∫–ª—é—á–∞—è --ask-become-pass –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è sudo.

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ad-hoc –∫–æ–º–∞–Ω–¥:

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—É–¥–æ.
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (--extra-vars) –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–µ.

–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________

	10.1. –ü—Ä–æ—Å—Ç–µ–π—à–∏–π playbook

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:
–ü–ª–µ–π–±—É–∫–∏ —è–≤–ª—è—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º Ansible, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –û–Ω–∏ —Å–ª—É–∂–∞—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–ª–µ–π–±—É–∫:

–û–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
–ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å —à–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–µ–π–±—É–∫–∞:

YAML —Ñ–∞–π–ª –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏–º–µ–Ω–∏ –ø–ª–µ–π–±—É–∫–∞.
–û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–ª–µ–π–±—É–∫.
–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (tasks), –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö ad hoc –∫–æ–º–∞–Ω–¥–∞–º, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–¥—É–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–µ–π–±—É–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

–ù–∞–∑–Ω–∞—á–∞–µ–º –∏–º—è –ø–ª–µ–π–±—É–∫—É –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ö–æ—Å—Ç—ã.
–í–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–¥–∞—á–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é –º–æ–¥—É–ª—è user –∏ –∑–∞–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–µ–π–±—É–∫–∞:

–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É ansible-playbook —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ —Å–∞–º–æ–≥–æ –ø–ª–µ–π–±—É–∫–∞.
–ú–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å sudo –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä -K, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

–í —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫ –¥–µ—Ç–∞–ª–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
–û–±—Å—É–∂–¥–∞–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Vault –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–æ–ª–µ–π –Ω–∞ –≥—Ä—É–ø–ø—É —Å–µ—Ä–≤–µ—Ä–æ–≤.	

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


	–û—Å–Ω–æ–≤—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Ansible: 

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ –ø–ª–µ–π–±—É–∫–µ, –ø–æ–∑–≤–æ–ª—è—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø–ª–µ–π–±—É–∫–∞ –∏–ª–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã).

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ Python (Ansible –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ Python).
–ù–µ –Ω–∞—á–∏–Ω–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–∏, –ø—Ä–æ–±–µ–ª–æ–≤, —Ç–æ—á–µ–∫, –¥–µ—Ñ–∏—Å–æ–≤ –∏ —Ü–∏—Ñ—Ä.
–ì–¥–µ –∑–∞–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–ú–µ—Å—Ç–∞ –∑–∞–¥–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: –í –ø–ª–µ–π–±—É–∫–µ, –±–ª–æ–∫–∞—Ö —Ç–∞—Å–∫–æ–≤, —Ç–∞—Å–∫–∞—Ö, –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, —á–µ—Ä–µ–∑ –≥—Ä—É–ø–ø—ã GroupVars –∏ HostVars, –∏ –∏—Å–ø–æ–ª—å–∑—É—è ExtraVars.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ Ansible

–ü—Ä–∏–º–µ—Ä—ã:

–í —Ç–∞—Å–∫–µ: –ü—Ä—è–º–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ —Ä–∞–∑–¥–µ–ª–µ vars.
–í –ø–ª–µ–π–±—É–∫–µ: –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–ª–µ–π–±—É–∫–∞.
–ß–µ—Ä–µ–∑ —Ñ–∞–π–ª: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ vars_files –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª.
–ò—Å–ø–æ–ª—å–∑—É—è –ø–ª–∞–≥–∏–Ω: GroupVars –∏ HostVars –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –æ—Ç —Å–∞–º—ã—Ö –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏) –¥–æ —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, ExtraVars).
–ß–µ–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–¥–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Ç–µ–º –≤—ã—à–µ –µ—ë –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–¥–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ —Å –ø–æ–º–æ—â—å—é vars_prompt: –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–æ–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–ª–µ–π–±—É–∫–∞.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ExtraVars –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
–ü—Ä–∏ –ø–æ–º–æ—â–∏ ExtraVars –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –ø–ª–µ–π–±—É–∫–∞, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª—å—à—É—é –≥–∏–±–∫–æ—Å—Ç—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á.

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


	10.3. –û—Ç–ª–∞–¥–∫–∞

–í–≤–µ–¥–µ–Ω–∏–µ

Ansible Playbook —á–∞—Å—Ç–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Å—Ç—ã–µ, –Ω–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º–∏ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–Ω–æ–≥–æ —Ä–æ–ª–µ–π –∏ –∑–∞–¥–∞—á.
–¶–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ - –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–°–ø–æ—Å–æ–±—ã –æ—Ç–ª–∞–¥–∫–∏

–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Console.log –≤ JavaScript.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Å–æ–ª—å.

–í Ansible –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–∞ register –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ debug –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–í–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ debugger —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏ (always, never, on_failed, on_unreachable, on_skip).

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–¥–∞—á–∏.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã: –∑–∞–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é out —á–µ—Ä–µ–∑ –∫–ª—é—á register.

---
- name: user
  hosts: demo
  tasks:
    - name: Create user
      vars:
        user: w
      user: 
        name: "{{ user }}"
        state: present
      become: true
      register: out
    - debug:
        var: out

–í—ã–≤–æ–¥ —Å –ø–æ–º–æ—â—å—é debug: 

–∏—Å–ø–æ–ª—å–∑—É–µ–º debug, —É–∫–∞–∑—ã–≤–∞—è out –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –≤—ã–≤–æ–¥–∞.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞: 

—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 
debugger: always 
–¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤.

---
- name: user
  hosts: demo
  tasks:
    - name: Create user
      vars:
        user: w
      user: 
        name: "{{ user }}"
        state: present
      become: true
      debugger: always

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏:

p –∏–ª–∏ print 
–¥–ª—è –≤—ã–≤–æ–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

> p task
TASK: Create user
> p task.name
'Create user'
> p task.args
> p task.vars
{'user': 'w'}
> p task_vars
> p task_vars['inventory_hostname']
'127.0.0.1'
> p task_vars['user']
'w'
> task.args['name']='e'
> p task_vars['user']
'e'
> task.args['state']='absent'
> r
changed: [127.0.0.1]
> p task.args
'name': 'e',
'state': 'absent'

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞—Å–∫–∞ —Å –ø–æ–º–æ—â—å—é 
r (retry).
–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞ —Å –ø–æ–º–æ—â—å—é c (continue) 
–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞—Å–∫–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ 
U (updateTask)

> u
> c


______________________________________
______________________________________
______________________________________
______________________________________
______________________________________

	10.4. –ë–ª–æ–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫


1. –í–≤–µ–¥–µ–Ω–∏–µ:

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á (—Ç–∞—Å–∫–æ–≤) —Å –æ–±—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ 
"Create User" –∏ 
"Install curl".

2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤:

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–¥–∞—á–∏ –≤ –±–ª–æ–∫–∏ –∏ –∫–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ–∫–∞ –∑–∞–¥–∞—Ç—å –æ–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, 
become 
–¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∞–≤.

3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–ª–æ–∫–æ–≤:

–í–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ 
rescue –∏ 
always 
–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–∫–∏.

4. –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ rescue –∏ always:

rescue –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –≤ —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏.

always —Å–ª—É–∂–∏—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—à–∏–±–æ–∫.

---
- name: user
  hosts: demo
  tasks:
    - name: Preconfig block
      block:
        - name: Create user
          vars:
            user: w
          user: 
            name: "{{ user }}"
            state: present
          register: error
        - name: Install curl
          apt: 
            name: curl
            update-cache: yes
          register: error
      become: true
      rescue:
        - name: Some error print
          debug:
            var: error
      always:
        - name: Reboot
          debug:
            msg: "Rebooooting"


5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ anyErrorFatal 

---
- name: user
  hosts: demo
  any_errors_fatal: true
  tasks:

–∏ ignoreErrors –¥–ª—è –≥–∏–±–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏.

---
- name: user
  hosts: demo
  tasks:
    - name: Preconfig block
      block:
        - name: Create user
          vars:
            user: w
          user: 
            name: "{{ user }}"
            state: present
          register: error
          ignore_errors: yes

–û–ø–∏—Å–∞–Ω—ã —Å–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

________- name: fail on FAILED
          command: echo "FAILED"
          register: command_result
          failed_when: "'FAILED' in command_result.stdout"

6. –£—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–æ–∫–æ–≤:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ when –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —É—Å–ª–æ–≤–∏—è–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–æ—Å—Ç–∞ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π.

______when: ansible_facts['distribution'] == 'CentOS'

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


	10.5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

–¶–µ–ª–∏:

–ü–æ–Ω—è—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–ª–µ–π–±—É–∫–æ–≤.
–ò–∑—É—á–∏—Ç—å –∫–ª—é—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ 
async –∏ poll.

–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

–ü–æ–Ω—è—Ç–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –≤ Ansible:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ SSH –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏:

async: 
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

poll: 
–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏: 
–ó–∞–¥–∞—á–∏ —Å 
poll –±–æ–ª—å—à–µ 0 
–¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞.

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏: 
–ó–∞–¥–∞—á–∏ —Å 
poll —Ä–∞–≤–Ω—ã–º 0 
–¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã:

–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã 
sleep 
–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏.
---
- name: user
  hosts: demo
  tasks:
    - name: Preconfig block
      block:
        - name: Sleep
          command: /bin/sleep 15
          async: 1000
          poll: 5
      become: true

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ—Ç–≤–µ—Ç–∞.

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ vs –∫–æ–º–∞–Ω–¥—ã:

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ Ansible –¥–ª—è –æ–±—â–∏—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, reboot) –∏–∑-–∑–∞ –∏—Ö —É–¥–æ–±—Å—Ç–≤–∞ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

Async –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–µ—Ä–æ–≤.
---
- name: user
  hosts: demo
  tasks:
    - name: Preconfig block
      block:
        - name: Sleep
          command: /bin/sleep 15
          async: 1000
          poll: 0
          register: sleep
        - debug:
            var: sleep
        - name: Echo
          command: echo "DONE" 
      become: true
    - name: Check sleep status
      async_status: 
        jid: "{{ sleep.ansible_job_id }}"
      register: job_result
      until: job_result.finished
      retries: 100
      delay: 1
      become: true

---
- name: user
  hosts: demo
  tasks:
    - name: Preconfig block
      block:
        - name: Reboot
          shell: "sleep 2 && reboot"
          async: 1000
          poll: 0
      become: true

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

https://docs.ansible.com/ansible/2.9/modules/wait_for_module.html#wait-for-module

–ú–æ–¥—É–ª—å 
WaitFor 
–¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤, –∫–æ–≥–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________

  10.6. –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ - –ü–∏—à–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞

–¶–µ–ª—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

–¶–µ–ª—å - –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible, –≤–∫–ª—é—á–∞—é—â–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫—É Docker, Docker Compose, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

–ú–æ–¥—É–ª–∏ Ansible

APT (apt, apt-repository, apt-key): –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.
Service: –†–∞–±–æ—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Å–ª—É–∂–±–∞–º–∏.
Get URL: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
User: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
Reboot: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã.

–®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker:

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Universe.
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (apt-transport-https, ce-certificates, –∏ –¥—Ä.).
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ Docker –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker CE (Docker Community Edition).
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ Docker.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose (—É–∂–µ –Ω–µ –Ω—É–∂–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö):

–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Docker Compose —á–µ—Ä–µ–∑ API GitHub.
–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose –≤ /usr/local/bin/docker-compose.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É Docker –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞:
–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É Docker.
–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–µ—Ä–∞.

–†–∞–±–æ—Ç–∞ —Å Ansible

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: 

ansible_user (—Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –∏ 
ansible_distribution_release (—Ä–µ–ª–∏–∑ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ Ubuntu), 

–ø–æ–∑–≤–æ–ª—è—é—â–∏–µ —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç –≤–µ—Ä—Å–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

–í–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –æ—Ç–¥–∞–µ—Ç—Å—è –º–æ–¥—É–ª—è–º Ansible –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Become: Yes –≤–∞–∂–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –æ—Ç –∏–º–µ–Ω–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ Ansible.

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤.

---
- name: Preconfig
  hosts: demo
  become: yes  
  tasks:
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
      block:
        - name: –î–æ–±–∞–≤–ª—è–µ–º universe
          apt_repository:
            repo: "deb http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }} universe"
            state: present

    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
      apt:
        name:
          - apt-transport-https
          - ca-certificates
          - curl
          - gnupg
          - lsb-release
        update-cache: yes
        cache_valid_time: 86400

    - name: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ Docker
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present
        keyring: /usr/share/keyrings/docker-archive-keyring.gpg

    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      apt_repository:
        repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
        state: present 
        update_cache: yes
        filename: docker

    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker-ce
      apt:
        name: docker-ce
        update_cache: yes

    - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –º–æ–¥—É–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω
      service:
        name: docker
        state: restarted
        enabled: yes

    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker-compose
      block:
      - name: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Docker-compose
        uri:
          url: https://api.github.com/repos/docker/compose/releases/latest
          body_format: json
        register: page

      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker-compose
        get_url:
          url: "https://github.com/docker/compose/releases/download/{{ page.json.tag_name }}/docker-compose-linux-x86_64"
          dest: /usr/local/bin/docker-compose
          mode: '0755'

    - name: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      block:
        - name: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
          user:
            name: '{{ ansible_user }}'
            groups: docker
            append: yes
        - name: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
          reboot:

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


10.7. Ansible lint


–û–±–∑–æ—Ä:

–ß—Ç–æ —Ç–∞–∫–æ–µ Ansible Lint? –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞ –∫–æ–¥–∞ –≤ Ansible, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –≤ –∫–æ–º–∞–Ω–¥–µ.
–ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? –ü–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–æ–π –ø—Ä–∞–≤–∏–ª.
–£—Å—Ç–∞–Ω–æ–≤–∫–∞: –ú–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ pip –¥–ª—è Windows/Linux –∏–ª–∏ brew –¥–ª—è Mac.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Ansible Lint:

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–∞: –ó–∞–ø—É—Å–∫ ansible-lint config.yaml –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–∏—Ç–µ–ª—å—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª .ansible-lint –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø—É—Ç–µ–π –∏–ª–∏ –ø—Ä–∞–≤–∏–ª.
–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –Ω–∞ Python (–Ω–µ –æ—Å–≤–µ—â–∞–µ—Ç—Å—è –≤ –Ω–∞—à–µ–º –∫—É—Ä—Å–µ).
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pre-commit:

–ß—Ç–æ —Ç–∞–∫–æ–µ pre-commit hook? –ú–µ—Ö–∞–Ω–∏–∑–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit hook —Å Ansible Lint:
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit —á–µ—Ä–µ–∑ homebrew –∏–ª–∏ pip.
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ pre-commit install –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .pre-commit-config.yaml —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª –∏ –≤–µ—Ä—Å–∏–∏ ansible-lint.
–ü—Ä–∏–º–µ—Ä—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞:

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Ansible Lint.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


  10.7. Ansible lint

–û–±–∑–æ—Ä:

–ß—Ç–æ —Ç–∞–∫–æ–µ Ansible Lint? 
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞ –∫–æ–¥–∞ –≤ Ansible, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –≤ –∫–æ–º–∞–Ω–¥–µ.

–ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? 
–ü–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–æ–π –ø—Ä–∞–≤–∏–ª.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞: 
–ú–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ pip –¥–ª—è Windows/Linux –∏–ª–∏ brew –¥–ª—è Mac.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Ansible Lint:

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–∞: 

–ó–∞–ø—É—Å–∫ ansible-lint config.yaml –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–∏—Ç–µ–ª—å—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª: 

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª 
.ansible-lint 
–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø—É—Ç–µ–π –∏–ª–∏ –ø—Ä–∞–≤–∏–ª.

–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è: 

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –Ω–∞ Python (–Ω–µ –æ—Å–≤–µ—â–∞–µ—Ç—Å—è –≤ –Ω–∞—à–µ–º –∫—É—Ä—Å–µ).

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pre-commit:

–ß—Ç–æ —Ç–∞–∫–æ–µ pre-commit hook? 

–ú–µ—Ö–∞–Ω–∏–∑–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit hook —Å Ansible Lint:

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit —á–µ—Ä–µ–∑ homebrew –∏–ª–∏ pip.

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ pre-commit install –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .pre-commit-config.yaml —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª –∏ –≤–µ—Ä—Å–∏–∏ ansible-lint.




–ü—Ä–∏–º–µ—Ä—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞:

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Ansible Lint.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
https://pre-commit.com/
https://github.com/ansible/ansible-lint/releases
v25.11.0

repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v2.3.0
    hooks:
    -   id: check-yaml
    -   id: end-of-file-fixer
    -   id: trailing-whitespace
-   repo: https://github.com/psf/black
    rev: 22.10.0
    hooks:
    -   id: black

    repos:
      - repo: https://github.com/ansible/ansible-lint.git
        rev: v6.22.2 # Use the desired ansible-lint version
        hooks:
          - id: ansible-lint

---
ci:
  # This section is specific to pre-commit.ci, telling it to create a pull request
  # to update the linter version tag every month.
  autoupdate_schedule: monthly
  # If you have other Ansible collection dependencies (requirements.yml)
  # `pre-commit.ci` will not be able to install them because it runs in offline mode,
  # and you will need to tell it to skip the hook.
  # skip:
  #   - ansible-lint
repos:
- repo: https://github.com/ansible/ansible-lint
  rev: ... # put latest release tag from https://github.com/ansible/ansible-lint/releases/
  hooks:
    - id: ansible-lint
      # Uncomment if you need the full Ansible community bundle instead of ansible-core:
      # additional_dependencies:
      #   - ansible
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________

https://github.com/settings/tokens
Personal access tokens (classic)
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

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


wget -O - https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(grep -oP '(?<=UBUNTU_CODENAME=).*' /etc/os-release || lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
sudo apt update && sudo apt install vagrant

wget -O - https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(grep -oP '(?<=UBUNTU_CODENAME=).*' /etc/os-release || lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list


  11.3. –†–∞–∑–≤—ë—Ä—Ç–∫–∞ –º–∞—à–∏–Ω vagrant

–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:

–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: –≠–∫–æ–Ω–æ–º–∏—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–≤–∞ —Ñ–∞–π–ª–∞: .gitignore –∏ –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ 23 —Å—Ç—Ä–æ—á–∫–∏, –ø–æ–¥–Ω–∏–º–∞—é—â–∏–π 5 –º–∞—à–∏–Ω.

–í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞—à–∏–Ω: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –æ—Ç 1 –¥–æ 5 (–∏–ª–∏ –±–æ–ª—å—à–µ, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤), –∫–∞–∂–¥–∞—è –º–∞—à–∏–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç 2GB –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤:

–Ø–∑—ã–∫: Vagrant –∫–æ–Ω—Ñ–∏–≥ –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Ruby.

–¶–∏–∫–ª: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç 1 –¥–æ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤, —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º –ø–æ—Ä—Ç–æ–≤, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º ssh-–∫–ª—é—á–µ–π –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏ –ø–∞–º—è—Ç–∏).

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ SSH –∫–ª—é—á–∞: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—É—Ç–∏ –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º.

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Vagrant: –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã vagrant up –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ VirtualBox. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—à–∏–Ω.

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º —á–µ—Ä–µ–∑ SSH –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Ö —Ä–∞–±–æ—Ç—ã.

https://github.com/AlariCode/vagrant-demo

sudo cp /opt/vagrant/embedded/gems/gems/vagrant-2.4.1/plugins/providers/virtualbox/driver/meta.rb /opt/vagrant/embedded/gems/gems/vagrant-2.4.1/plugins/providers/virtualbox/driver/meta.rb.backup

sudo sed -i '/driver_map = {/a\          "7.2" => Version_7_0,' /opt/vagrant/embedded/gems/gems/vagrant-2.4.1/plugins/providers/virtualbox/driver/meta.rb

  —Ä–∞–±–æ—á–∏–π –ø–∞—Ç—á
sudo sed -i '/driver_klass = nil/a\          driver_klass = Version_7_0' /opt/vagrant/embedded/gems/gems/vagrant-2.4.1/plugins/providers/virtualbox/driver/meta.rb

Vagrantfile

# ENV['VAGRANT_DISABLE_VBOXCHECK'] = '1'

Vagrant.configure("2") do |config|
  (1..5).each do |i|
    config.vm.define "server#{i}" do |web|
      web.vm.box = "ubuntu/focal64"
      web.vm.network "forwarded_port", id: "ssh", host: 2222 + i, guest: 22
      web.vm.network "private_network", ip: "10.11.10.#{i}", virtualbox__intnet: true
      web.vm.hostname = "server#{i}"

      web.vm.provision "shell" do |s|
        ssh_pub_key = File.readlines("#{Dir.home}/.ssh/id_rsa.pub").first.strip
        s.inline = <<-SHELL
        echo #{ssh_pub_key} >> /home/vagrant/.ssh/authorized_keys
        echo #{ssh_pub_key} >> /root/.ssh/authorized_keys
        SHELL
      end

      web.vm.provider "virtualbox" do |v|
        v.name = "server#{i}"
        v.memory = 2048
        v.cpus = 1
      end
    end
  end
end

--------------------------------
.gitignore
/.vagrant

–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

vagrant up --provider=virtualbox

vagrant status

Vagrant up = —Å–æ–∑–¥–∞–µ—Ç –ò –∑–∞–ø—É—Å–∫–∞–µ—Ç –í–ú

Vagrant halt = –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –í–ú

Vagrant destroy = —É–¥–∞–ª—è–µ—Ç –í–ú

–ï—Å–ª–∏ –í–ú —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã - vagrant up –∏—Ö –∑–∞–ø—É—Å—Ç–∏—Ç

Vagrant –í–ú –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ 127.0.0.1 (localhost)

–ü–æ—Ä—Ç—ã –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ vagrant port

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è inventory —á–µ—Ä–µ–∑ vagrant ssh-config - —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


  12.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Swarm

–ü–æ—á–µ–º—É Docker Swarm?

–ü—Ä–æ—Å—Ç –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö
–í—Å—Ç—Ä–æ–µ–Ω –≤ Docker
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞–ª—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Docker Swarm

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤
–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Å–µ—Ä–≤–∏—Å–æ–≤
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏
–ü—Ä–æ—Å—Ç–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Docker Swarm

–°–µ—Ä–≤–µ—Ä—ã —Å —Ä–æ–ª—è–º–∏ Worker –∏ Manager
–ú–æ–¥–µ–ª—å –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ Raft –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
–ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–µ—Ä—é (n-1)/2 –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –º–∞–∫—Å–∏–º—É–º 7 –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
–†–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è (Promote/Demote)

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


  12.2. –ó–∞–ø—É—Å–∫–∞–µ–º swarm


1. –í–≤–µ–¥–µ–Ω–∏–µ

–ù–∞—á–Ω–µ–º —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Swarm. –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –≤–∏–¥–µ–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, —á–µ—Ä–µ–∑ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–π —Å–µ—Ç–∏.
–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö IP –≤ VirtualBox –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏.


2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Swarm

–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Swarm —Å –ø–æ–º–æ—â—å—é docker swarm init.
–í–æ–∑–Ω–∏–∫–∞–µ—Ç –≤—ã–±–æ—Ä Ethernet-–ø–æ—Ä—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è; –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—ã–π —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ --advertise-address.
–°–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–Ω–æ–Ω–æ–¥–æ–≤—ã–π Swarm-–∫–ª–∞—Å—Ç–µ—Ä.

vagrant@server1:~$ docker swarm init --advertise-addr 10.11.10.1
Swarm initialized: current node (qeqi1cfxemdcc4m6mlkm7yoq9) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-65uc4dkfug9qsge44yt8s8if0f8dyun6pseiwx0lexqhjxhl31-6h2dwd8od7w8xyd3g6d963pcb 10.11.10.1:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –í–æ—Ä–∫–µ—Ä–æ–≤

docker swarm join-token manager
docker swarm join --token SWMTKN-1-65uc4dkfug9qsge44yt8s8if0f8dyun6pseiwx0lexqhjxhl31-db8xbasqzmn2warbqvk0qynqc 10.11.10.1:2377
docker node ls
docker swarm join-token worker

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∂–µ–ª–∞–µ–º–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞: 3 –º–µ–Ω–µ–¥–∂–µ—Ä–∞, 2 –≤–æ—Ä–∫–µ—Ä–∞.
–ò—Å–ø–æ–ª—å–∑—É–µ–º docker-swarm join-token –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–æ–¥ –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏–ª–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤.
4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ù–æ–¥–∞–º–∏ –∏ –ö–ª–∞—Å—Ç–µ—Ä–æ–º

$ docker swarm --help

Commands:
  ca          Display and rotate the root CA
  init        Initialize a swarm
  join        Join a swarm as a node and/or manager
  join-token  Manage join tokens
  leave       Leave the swarm
  unlock      Unlock swarm
  unlock-key  Manage the unlock key
  update      Update the swarm

docker swarm update --task-history-limit 6

$ docker node --help

Commands:
  demote      Demote one or more nodes from manager in the swarm
  inspect     Display detailed information on one or more nodes
  ls          List nodes in the swarm
  promote     Promote one or more nodes to manager in the swarm
  ps          List tasks running on one or more nodes, defaults to current node
  rm          Remove one or more nodes from the swarm
  update      Update a node

docker node inspect server5 --pretty

ID:     cp13nrg7uvdt9c8l0u4j3amdc
Hostname:               server5
Joined at:              2025-11-15 22:17:55.488061422 +0000 utc
Status:
 State:     Ready
 Availability:          Active
 Address:   10.11.10.5
Platform:
 Operating System:  linux
 Architecture:    x86_64
Resources:
 CPUs:      1
 Memory:    1.925GiB
Plugins:
 Log:   awslogs, fluentd, gcplogs, gelf, journald, json-file, local, splunk, syslog
 Network:   bridge, host, ipvlan, macvlan, null, overlay
 Volume:    local
Engine Version:   28.1.1
TLS Info:
 TrustRoot:
-----BEGIN CERTIFICATE-----
MIIBajCCARCgAwIBAgIUYZ4iGcWtLCJAXIwT24CZgAXKyBwwCgYIKoZIzj0EAwIw
EzERMA8GA1UEAxMIc3dhcm0tY2EwHhcNMjUxMTE1MjE1NjAwWhcNNDUxMTEwMjE1
NjAwWjATMREwDwYDVQQDEwhzd2FybS1jYTBZMBMGByqGSM49AgEGCCqGSM49AwEH
A0IABDsEWaD4ojqIykognkOq6aEvMgXfvrIhyrozZqi9mCATp/MTFTASfUQkHSj5
EyxZ3Z6oSszfJnQqPn070072lc+jQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMB
Af8EBTADAQH/MB0GA1UdDgQWBBSkIpiu9q/jh1KkupZOThub/hu4KDAKBggqhkjO
PQQDAgNIADBFAiB6uakJGKYswbkkyFj11Ghxz9gSG3k463kVeYqH9N7wlwIhAP9i
okqnI4EeokFy+a1R7FiFjUxn2DjGFfWpgB85QpPu
-----END CERTIFICATE-----

 Issuer Subject:  MBMxETAPBgNVBAMTCHN3YXJtLWNh
 Issuer Public Key: MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOwRZoPiiOojKSiCeQ6rpoS8yBd++siHKujNmqL2YIBOn8xMVMBJ9RCQdKPkTLFndnqhKzN8mdCo+fTvTTvaVzw==


–ò—Å–ø–æ–ª—å–∑—É–µ–º docker-node ls –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ç–∏–ø–∞ –Ω–æ–¥.
docker-node promote –∏ docker-node demote –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏ –Ω–æ–¥.
–£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–¥—ã –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞: docker node rm <–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä>.
5. –°—Ç–∞—Ç—É—Å—ã –ù–æ–¥

Active ‚Äì –Ω–æ–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–¥–∞—á–∏.
Pause ‚Äì –Ω–æ–¥–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –Ω–æ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É.
Drain ‚Äì –Ω–æ–¥–∞ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏ "—Å–ª–∏–≤–∞–µ—Ç" —Ç–µ–∫—É—â–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –¥—Ä—É–≥–∏–º –Ω–æ–¥–∞–º.
6. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

docker node update –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–æ–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ active, pause, –∏–ª–∏ drain.
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ª–µ–π–±–ª–æ–≤ –¥–ª—è –Ω–æ–¥, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–µ–ø–ª–æ–µ–º.


______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


12.3. –°–µ—Ä–≤–∏—Å—ã –∏ –∑–∞–¥–∞—á–∏

–í–≤–µ–¥–µ–Ω–∏–µ –≤ Docker Swarm

–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–≤—É–º—è API –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Swarm.

Docker Swarm —É–ø—Ä–æ—â–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤, –∏—Ö –∑–∞–¥–∞—á –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Swarm.

–ö–∞–∫ Swarm –£–ø—Ä–∞–≤–ª—è–µ—Ç –°–µ—Ä–≤–∏—Å–∞–º–∏

–û–ø–∏—Å–∞–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –°–æ–æ–±—â–∞–µ–º Swarm –∫–æ–ª-–≤–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –Ω–∞–º API.
–°–æ–∑–¥–∞–Ω–∏–µ –ó–∞–¥–∞—á–∏: Swarm –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –Ω–∞ –Ω–æ–¥—ã: API 1 –Ω–∞ –ø–µ—Ä–≤–æ–π –Ω–æ–¥–µ –∏ API 2 –Ω–∞ –≤—Ç–æ—Ä–æ–π.
–°—Ç–∞—Ç—É—Å—ã –ó–∞–¥–∞—á–∏: –ó–∞–¥–∞—á–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã –æ—Ç "–Ω–æ–≤–∞—è" –¥–æ "–∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä".
–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ó–∞–¥–∞—á–∏: –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –Ω–µ–π.

–°–æ–∑–¥–∞–Ω–∏–µ –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ—Ä–≤–∏—Å–æ–º –≤ Swarm

–°–æ–∑–¥–∞–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –ö–æ–º–∞–Ω–¥–∞ docker service create –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–∏—Å.
–ò–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é docker service inspect.
–õ–æ–≥–∏ –°–µ—Ä–≤–∏—Å–∞: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ docker service logs.
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª-–≤–æ–º —Ä–µ–ø–ª–∏–∫ —Å–µ—Ä–≤–∏—Å–∞ —Å –ø–æ–º–æ—â—å—é docker service scale.
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ docker service update, –≤–∫–ª—é—á–∞—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Ç–µ–≥–æ–º.
–£–¥–∞–ª–µ–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞: –ö–æ–º–∞–Ω–¥–∞ docker service rm —É–¥–∞–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å.
–†–æ–ª–ª–±—ç–∫ –°–µ—Ä–≤–∏—Å–∞: –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ —Å –ø–æ–º–æ—â—å—é docker service rollback.


docker service --help

Manage Swarm services

Commands:
  create      Create a new service
  inspect     Display detailed information on one or more services
  logs        Fetch the logs of a service or task
  ls          List services
  ps          List the tasks of one or more services
  rm          Remove one or more services
  rollback    Revert changes to a service's configuration
  scale       Scale one or multiple replicated services
  update      Update a service

------------------

docker service inspect redis --pretty

ID:   k86vp1okun2jwh6e9egb7orvq
Name:   redis
Service Mode: Replicated
 Replicas:  1
Placement:
UpdateConfig:
 Parallelism: 1
 On failure:  pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Update order:      stop-first
RollbackConfig:
 Parallelism: 1
 On failure:  pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Rollback order:    stop-first
ContainerSpec:
 Image:   redis:latest@sha256:5c7c0445ed86918cb9efb96d95a6bfc03ed2059fe2c5f02b4d74f477ffe47915
 Init:    false
Resources:

------------------

docker service ps redis
ID             NAME      IMAGE          NODE      DESIRED STATE   CURRENT STATE           ERROR     PORTS
vq6ghxjp68pz   redis.1   redis:latest   server4   Running         Running 2 minutes ago    docker service ps redis
ID             NAME      IMAGE          NODE      DESIRED STATE   CURRENT STATE           ERROR     PORTS
vq6ghxjp68pz   redis.1   redis:latest   server4   Running         Running 2 minutes ago    

-----------------

docker service rm redis
-----------------

docker service scale redis=2

redis scaled to 2
overall progress: 2 out of 2 tasks 
1/2: running   [==================================================>] 
2/2: running   [==================================================>] 
verify: Service redis converged 

docker service ps redis
ID             NAME      IMAGE          NODE      DESIRED STATE   CURRENT STATE            ERROR     PORTS
tybkfek2aqj8   redis.1   redis:latest   server2   Running         Running 3 minutes ago              
8c37wmugs0pf   redis.2   redis:latest   server4   Running         Running 12 seconds ago     

------------------

docker service logs 8c37wmugs0pf

------------------

docker service update --help

üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ü–∏–∏ docker service update

üèóÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

--image - üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–∞
--env-add / --env-rm - üå°Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
--args / --entrypoint - ‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ—Å—É—Ä—Å—ã

--replicas - üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–ª—É–∂–±—ã
--limit-cpu / --limit-memory - ‚öñÔ∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
--reserve-cpu / --reserve-memory - üíæ –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

üåê –°–µ—Ç—å –∏ –ø–æ—Ä—Ç—ã

--publish-add / --publish-rm - üîå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±—Ä–æ—Å–æ–º –ø–æ—Ä—Ç–æ–≤
--network-add / --network-rm - üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç—è–º

‚ö° –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

--update-parallelism - üéØ –°–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
--update-delay - ‚è∞ –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
--rollback - ‚Ü©Ô∏è –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–∞–Ω–Ω—ã–µ

--config-add / --config-rm - üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏
--secret-add / --secret-rm - üóùÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

üéØ –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ

--force - üí™ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
--detach - üèÉ –ù–µ –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
--with-registry-auth - üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ registry

üí° –ö—Ä–∞—Ç–∫–æ: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–æ—Ä—è—á–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Docker Swarm –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è

------------------

docker service update --image=redis:6.0.2 redis
redis
overall progress: 2 out of 2 tasks 
1/2: running   [==================================================>] 
2/2: running   [==================================================>] 
verify: Service redis converged 

------------------

docker service update --rollback redis
redis
rollback: manually requested rollback 
overall progress: rolling back update: 2 out of 2 tasks 
1/2: running   [==================================================>] 
2/2: running   [==================================================>] 
verify: Service redis converged

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


  12.4. –°–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è:

–ö–æ–Ω—Ñ–∏–≥–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã - –º–µ—Ö–∞–Ω–∏–∑–º—ã Docker –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.

–ö–æ–Ω—Ñ–∏–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –∏ –≤–∏–¥–Ω—ã –≤—Å–µ–º.

–°–µ–∫—Ä–µ—Ç—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –û–¥–Ω–∞–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–º –≤–∏–¥–µ.

–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ù–∞ Swarm Manager:

–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤: config create.

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –∫ –Ω–µ–º—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å.

–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

–ö–æ–Ω—Ñ–∏–≥–∏: —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –∫–æ–Ω—Ñ–∏–≥–∞.

–°–µ–∫—Ä–µ—Ç—ã: –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –≤ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

–°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–º–µ—é—Ç —Å—Ö–æ–∂–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ—á—å —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è —Ç–∞–º –¥–∞–Ω–Ω—ã–µ.

–°–µ–∫—Ä–µ—Ç—ã –æ–±–ª–∞–¥–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –±–æ–Ω—É—Å–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, –∫—Ä–æ–º–µ –µ–≥–æ –∑–∞–ø—É—Å–∫–∞.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞: —á–µ—Ä–µ–∑ —Ñ–∞–π–ª –∏–ª–∏ STDIN, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ.

–£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç.

–ö–æ–Ω—Ñ–∏–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–µ–∫—Ä–µ—Ç–∞–º, –Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–µ–º –∂–µ –æ–±—Ä–∞–∑–æ–º.

–í–∞–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥–æ–≤ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö: –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–µ –∑–Ω–∞—è, –≥–¥–µ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ –≥–∏–±–∫–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –≤ Docker Swarm.

docker secret --help

Manage Swarm secrets

Commands:
  create      Create a secret from a file or STDIN as content
  inspect     Display detailed information on one or more secrets
  ls          List secrets
  rm          Remove one or more secrets

--------------------
docker exec -it redis.1.ech8k7u88sccwr5yroomi7r7w sh
pwd  
/data

cd ..
pwd
/

cd run
ls
lock  secrets

cd secrets
ls
my_pass
cat my_pass
12345

---------------------

docker secret rm my_pass
Error response from daemon: rpc error: code = InvalidArgument desc = secret 'my_pass' is in use by the following service: redis
docker  service rm redis 
docker secret rm my_pass

--------------------

docker config
Manage Swarm configs

Commands:
  create      Create a config from a file or STDIN
  inspect     Display detailed information on one or more configs
  ls          List configs
  rm          Remove one or more configs
---------------------

echo "6789" | docker config  create my_conf -
5ng00ltur5fu92k5pl9r2uln6

---------------------

docker ps
docker exec -it redis.1.f5h10j6kgew8e6xmnvwwtpodr sh
pwd
/data
cd ..
ls
bin   data  etc   lib  media  my_conf  proc  run   srv  tmp  var
boot  dev   home  lib64  mnt  opt  root  sbin  sys  usr
cat my_conf
6789

---------------------

______________________________________
______________________________________
______________________________________
______________________________________
______________________________________


12.5. Statefull —Å–µ—Ä–≤–∏—Å—ã

–í–≤–µ–¥–µ–Ω–∏–µ:

–¶–µ–ª—å: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã Stateful-—Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Docker Registry.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Stateful-—Å–µ—Ä–≤–∏—Å–æ–≤: –û—Ç–ª–∏—á–∞—é—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º).

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏–º–∏–¥–∂–∞: –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ Swarm —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –∏–º–∏–¥–∂.

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

–ü–æ–¥–Ω—è—Ç–∏–µ Registry: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–∏–¥–∂–µ–π, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Å–µ–º —Å–µ—Ä–≤–µ—Ä–∞–º.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

–û–ø—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

Shared Mount: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∞—è –ø–∞–ø–∫–∞ –∏–ª–∏ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Å–µ–º –Ω–æ–¥–∞–º.

Constraints: –ó–∞–¥–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –Ω–æ–¥–∞—Ö.

–ü—Ä–∞–∫—Ç–∏–∫–∞:

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–¥—ã:

–õ–µ–π–±–ª–∏–Ω–≥ –Ω–æ–¥—ã –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è Registry —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã 

docker node update.

–ó–∞–ø—É—Å–∫ Docker Registry:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –Ω–æ–¥–µ —Å –Ω—É–∂–Ω—ã–º –ª–µ–π–±–ª–æ–º.

–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è Registry.

–°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:

–°–±–æ—Ä–∫–∞ –∏–º–∏–¥–∂–∞: –ò—Å–ø–æ–ª—å–∑—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫–µ—Ä-—Ñ–∞–π–ª.

–ü—É—à –∏ –ø—É–ª –∏–º–∏–¥–∂–∞: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–º–∏–¥–∂–∞ –≤ Registry –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–æ–π –Ω–æ–¥–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.

–ò—Ç–æ–≥–∏:

Stateful-—Å–µ—Ä–≤–∏—Å—ã —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

Docker Registry –∫–∞–∫ –ø—Ä–∏–º–µ—Ä Stateful-—Å–µ—Ä–≤–∏—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–º–∏–¥–∂–µ–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–æ–≤ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Stateful-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Swarm.

----------------------

docker node update server1 --
--availability  (Availability of the node ("active", "pause", "drain"))
--label-add     (Add or update a node label ("key=value"))
--label-rm      (Remove a node label if exists)
--role          (Role of the node ("worker", "manager"))

$ docker node update server1 --label-add registry=true
server1

vagrant@server1:~$ docker node inspect server1
[
    {
        "ID": "qeqi1cfxemdcc4m6mlkm7yoq9",
        "Version": {
            "Index": 171
        },
        "CreatedAt": "2025-11-15T22:01:11.587419127Z",
        "UpdatedAt": "2025-11-16T15:57:22.110045523Z",
        "Spec": {
            "Labels": {
                "registry": "true"

----------------------

docker service create --name registry --publish 5000:5000 --constraint node.role.registry==true --mount type=bind,source=/registry,destination=/var/lib/registry -e REGISTRY_HTTP_ADDR=0.0.0.0:5000 registry:latest 


–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è Docker-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Ä–µ–µ—Å—Ç—Ä–∞ (Registry). üìö
docker service create üê≥ ‚ûïüü¢
docker service create = –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –≤ Docker Swarm (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤). –≠—Ç–æ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.

--name registry üè∑Ô∏è üì¶
–î–∞–µ–º —Å–µ—Ä–≤–∏—Å—É –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è registry, —á—Ç–æ–±—ã –ª–µ–≥–∫–æ –∫ –Ω–µ–º—É –æ–±—Ä–∞—â–∞—Ç—å—Å—è.

--publish 5000:5000 üåê üöÄ üîÑ
–ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç. –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç 5000 –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —Å–≤—è–∑—ã–≤–∞–µ–º –µ–≥–æ —Å –ø–æ—Ä—Ç–æ–º 5000 –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ä–µ–µ—Å—Ç—Ä—É –∏–∑–≤–Ω–µ.

--constraint node.role.registry==true üìçü§ñ ‚úÖ
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è. –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –¢–û–õ–¨–ö–û –Ω–∞ —Ç–æ–π –Ω–æ–¥–µ (—É–∑–ª–µ –∫–ª–∞—Å—Ç–µ—Ä–∞), —É –∫–æ—Ç–æ—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –º–µ—Ç–∫–∞ node.role.registry=true. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ä–µ–µ—Å—Ç—Ä "–ø—Ä–∏–±–∏—Ç" –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É.

--mount type=bind,source=/registry,destination=/var/lib/registry üíΩ üîó üìÅ
–ú–æ–Ω—Ç–∏—Ä—É–µ–º —Ç–æ–º (—Ö—Ä–∞–Ω–∏–ª–∏—â–µ).

type=bind = –°–≤—è–∑—ã–≤–∞–µ–º –ø–∞–ø–∫—É —Å —Ö–æ—Å—Ç–∞ —Å –ø–∞–ø–∫–æ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
source=/registry = –ü–∞–ø–∫–∞ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ (—Å–µ—Ä–≤–µ—Ä–µ), –≥–¥–µ –±—É–¥—É—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –æ–±—Ä–∞–∑—ã.
destination=/var/lib/registry = –ü–∞–ø–∫–∞ –í–ù–£–¢–†–ò –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∫—É–¥–∞ —Ä–µ–µ—Å—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ.
–í–∞–∂–Ω–æ! –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è. üíæ

-e REGISTRY_HTTP_ADDR=0.0.0.0:5000 ‚öôÔ∏è üåê üìç
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ì–æ–≤–æ—Ä–∏–º —Ä–µ–µ—Å—Ç—Ä—É —Å–ª—É—à–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –∞–¥—Ä–µ—Å–µ 0.0.0.0 (–≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã) –∏ –ø–æ—Ä—Ç—É 5000. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ Swarm.

registry:latest üì¶ üè∑Ô∏è üîº
–û–±—Ä–∞–∑ Docker, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ registry.

–ö—Ä–∞—Ç–∫–∞—è —Å—É—Ç—å:
üê≥ ‚ûïüü¢ –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –≤ Swarm —Å –∏–º–µ–Ω–µ–º üè∑Ô∏è üì¶ registry.
–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç üåê 5000, —á—Ç–æ–±—ã —Ä–µ–µ—Å—Ç—Ä –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω.
–ó–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥–µ —Å –ø–æ–º–æ—â—å—é üìçü§ñ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
–°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–ø–∫—É —Ö–æ—Å—Ç–∞ üíΩ /registry, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å.
–ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ üì¶ registry:latest.

–†–µ–∑—É–ª—å—Ç–∞—Ç: üéØ –£ –≤–∞—Å –∑–∞–ø—É—â–µ–Ω –ø—Ä–∏–≤–∞—Ç–Ω—ã–π Docker Registry –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Swarm, –≥–æ—Ç–æ–≤—ã–π –∫ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –≤—ã–≥—Ä—É–∑–∫–µ –æ–±—Ä–∞–∑–æ–≤.



Docker Registry ‚Äî —ç—Ç–æ –∫–∞–∫ üì¶üîí —á–∞—Å—Ç–Ω—ã–π —Å–∫–ª–∞–¥ –¥–ª—è –≤–∞—à–∏—Ö Docker-–æ–±—Ä–∞–∑–æ–≤. –í–æ—Ç –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω, —Å —ç–º–æ–¥–∑–∏ –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞:

üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å:
üê≥ üì¶ ‚û°Ô∏è üîí üì• –•—Ä–∞–Ω–∏—Ç—å –≤–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ Docker-–æ–±—Ä–∞–∑—ã –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π Docker Hub.

üìã –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. üîí –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

üè¢üíº –í–∞—à –∫–æ–¥ = –í–∞—à–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
–ó–∞—â–∏—Ç–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ç–∞–π–Ω—ã ‚Äî –æ–±—Ä–∞–∑—ã —Å –≤–∞—à–∏–º –∫–æ–¥–æ–º –Ω–µ —É—Ö–æ–¥—è—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–µ–º, –∫—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—Ä–∞–∑–∞–º
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º (GDPR, HIPAA –∏ –¥—Ä.) ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç –≤–∞—à—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

2. üöÄ –°–∫–æ—Ä–æ—Å—Ç—å –∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

üåê‚ö°Ô∏è –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å > –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
–ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Äî –Ω–µ –∫–∞—á–∞–µ–º –≥–∏–≥–∞–±–∞–π—Ç—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
–ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞

3. üí∞ –≠–∫–æ–Ω–æ–º–∏—è –¥–µ–Ω–µ–≥

üí∞üö´ –ù–µ—Ç –ø–ª–∞—Ç—ã –∑–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤
–ù–µ—Ç –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

4. üè≠ CI/CD –∏ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

üîÑ‚öôÔ∏è –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∞
–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Å–±–æ—Ä–∫–∏ ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç–µ –æ–±—Ä–∞–∑ ‚Üí –ø—É—à–∏—Ç–µ –≤ —Å–≤–æ–π registry ‚Üí —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ –≥–¥–µ –Ω—É–∂–Ω–æ
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –¥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ prod
–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –≤–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

5. üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

üõ°Ô∏è‚úÖ –í—ã —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –±—ç–∫–∞–ø–∏—Ç–µ –æ–±—Ä–∞–∑—ã –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é

üè¢ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ ‚Üí üèóÔ∏è –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ ‚Üí üì§ –ü—É—à–∏—Ç –≤ Private Registry ‚Üí üöÄ DevOps —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç

üè≠ CI-—Å–µ—Ä–≤–µ—Ä (Jenkins/GitLab) ‚Üí üî® –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ ‚Üí üì¶ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Registry ‚Üí üåê Production-—Å–µ—Ä–≤–µ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç


üíé –ò—Ç–æ–≥:
Docker Registry ‚Äî —ç—Ç–æ –≤–∞—à üîíüì¶ —á–∞—Å—Ç–Ω—ã–π —Å–∫–ª–∞–¥ –æ–±—Ä–∞–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç:
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å üîê
–°–∫–æ—Ä–æ—Å—Ç—å ‚ö°
–ö–æ–Ω—Ç—Ä–æ–ª—å üéØ
–≠–∫–æ–Ω–æ–º–∏—é üí∞
–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å üè≠
–ë–µ–∑ –Ω–µ–≥–æ: –≤—Å–µ –æ–±—Ä–∞–∑—ã –≤ –ø—É–±–ª–∏—á–Ω–æ–º Docker Hub –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Ä—É—á–Ω–∞—è –ø–µ—Ä–µ–±—Ä–æ—Å–∫–∞ —Ñ–∞–π–ª–æ–≤. üò´
–° –Ω–∏–º: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. üöÄ‚ú®

-------------------------


docker service rm registry

üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
üê≥ Docker Swarm ‚Üí üóëÔ∏è –£–¥–∞–ª–∏—Ç—å ‚Üí üì¶ –°–µ—Ä–≤–∏—Å "registry"

üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:
docker service üê≥ ‚öôÔ∏è - –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤ Docker Swarm (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞)

rm üóëÔ∏è ‚ùå - –ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è (remove)

registry üì¶üè∑Ô∏è - –ò–º—è —É–¥–∞–ª—è–µ–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

‚ö° –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:

üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ - –í—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–µ–µ—Å—Ç—Ä–∞ –±—É–¥—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ - –°–µ—Ä–≤–∏—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è Swarm
üßπ –û—á–∏—Å—Ç–∫–∞ - –£–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

üîç –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã:

‚ö†Ô∏è üìÅ –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è!
–ü–∞–ø–∫–∞ /registry –Ω–∞ —Ö–æ—Å—Ç–µ (–∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞) –ù–ï —É–¥–∞–ª–∏—Ç—Å—è
–í—Å–µ –æ–±—Ä–∞–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ –≤ —Ä–µ–µ—Å—Ç—Ä, —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ
üîÑ üöÄ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å - –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É 
docker service create... 
–∏ —Ä–µ–µ—Å—Ç—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

üíé –ò—Ç–æ–≥:

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å Registry –∏–∑ Docker Swarm, –Ω–æ –ù–ï —É–¥–∞–ª—è–µ—Ç –≤–∞—à–∏ –æ–±—Ä–∞–∑—ã –∏ –¥–∞–Ω–Ω—ã–µ!
–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:
bash
docker service rm registry    # üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo rm -rf /registry         # üí• –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
bash
docker service rm registry
docker service create ...     # üîÑ –°–Ω–æ–≤–∞ —Å–æ–∑–¥–∞—Ç—å —Å —Ç–µ–º–∏ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

------------------------

registry

üì¶ Docker Registry üê≥ üì•üì§

Docker Registry ‚Äî —ç—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π) –¥–ª—è Docker-–æ–±—Ä–∞–∑–æ–≤. –≠—Ç–æ –∫–∞–∫:

üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Docker-–æ–±—Ä–∞–∑–æ–≤
üì¶ –°–∫–ª–∞–¥ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
üçé App Store –¥–ª—è –≤–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

üè† –¢–∏–ø—ã Registry:

1. üîì –ü—É–±–ª–∏—á–Ω—ã–π Registry

Docker Hub (docker.io) - –ë–ï–°–ü–õ–ê–¢–ù–û

–ü—É–±–ª–∏—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã üÜì - nginx, redis, ubuntu
–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–∑—ã üí∞ - –ø–ª–∞—Ç–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –∫–æ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç–µ docker pull, –æ–±—Ä–∞–∑ –∏–¥–µ—Ç –æ—Ç—Å—é–¥–∞

2. üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π Registry (—Ç–æ—Ç, —á—Ç–æ –º—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏)

–í–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π registry –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å üéõÔ∏è
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å üîê
–°–∫–æ—Ä–æ—Å—Ç—å ‚ö°

üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

bash
# üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –≤ registry

docker push my-registry:5000/my-app:1.0

# üì• –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ registry 

docker pull my-registry:5000/my-app:1.0

# üè∑Ô∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑ –¥–ª—è registry

docker tag my-app:1.0 my-registry:5000/my-app:1.0

üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

registry:latest (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) ‚Üí /var/lib/registry (–≤–Ω—É—Ç—Ä–∏) ‚Üí /registry (–Ω–∞ —Ö–æ—Å—Ç–µ) üíæ

üåê –î–æ—Å—Ç—É–ø:

üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ ‚Üí üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí üåê Registry:5000 ‚Üí üì¶ –û–±—Ä–∞–∑—ã

üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

HTTPS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω—É–∂–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
HTTP –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞–∫ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ)
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ .htpasswd

üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ü—Ä–∏–º–µ—Ä workflow:

bash
# 1. üèóÔ∏è –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑

docker build -t my-app:1.0 .

# 2. üè∑Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–ª—è registry

docker tag my-app:1.0 localhost:5000/my-app:1.0

# 3. üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ registry

docker push localhost:5000/my-app:1.0

# 4. üì• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–¥–µ —É–≥–æ–¥–Ω–æ

docker pull localhost:5000/my-app:1.0

üíé –ò—Ç–æ–≥:

Docker Registry ‚Äî —ç—Ç–æ üì¶ —Å–∫–ª–∞–¥ –æ–±—Ä–∞–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –±—ã–≤–∞–µ—Ç:
üîì –ü—É–±–ª–∏—á–Ω—ã–π (Docker Hub) - –¥–ª—è –æ–±—â–∏—Ö –æ–±—Ä–∞–∑–æ–≤
üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π (–≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π) - –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö/–∑–∞–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

–î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω –ø—Ä–∏–≤–∞—Ç–Ω—ã–π registry:

üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
üîê –ó–∞—â–∏—Ç–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
‚ö° –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
üöÄ CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Docker! üê≥‚ú®


-----------------------

# üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –≤ registry
docker tag my-image localhost:5000/my-image
docker push localhost:5000/my-image

# üì• –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ registry
docker pull localhost:5000/my-image

# üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—Ä–∞–∑—ã –≤ registry
curl http://localhost:5000/v2/_catalog

-----------------------
vagrant@server3:~$ docker build -t localhost:5000/api:latest -f apps/api/Dockerfile .
vagrant@server3:~$ docker push localhost:5000/api
vagrant@server1:~$ docker service ps registry
vagrant@server5:~$ docker pull localhost:5000/api:latest



----------------------



üìä Stateful vs Stateless

üî¥ Stateless (–ë–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è)

üåê Web-—Å–µ—Ä–≤–µ—Ä, üöÄ API, üîÑ Proxy

–ù–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
–ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å ‚ÜîÔ∏è
–õ—é–±–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å

–ü—Ä–∏–º–µ—Ä: Nginx, Node.js API

üü¢ Stateful (–° —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)

üíæ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, üì¶ Registry, üìÅ –§–∞–π–ª–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–•—Ä–∞–Ω—è—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ üíæ
–°–ª–æ–∂–Ω–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å ‚öñÔ∏è
–ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–≤–æ–µ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É

üéØ –ü–æ—á–µ–º—É Registry ‚Äî Stateful —Å–µ—Ä–≤–∏—Å:

1. üíæ –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤
üì¶ image:v1.0
üì¶ image:v1.1  
üì¶ my-app:latest
–û–±—Ä–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏

2. üóÇÔ∏è –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É
--mount type=bind,source=/home/vagrant/registry,destination=/var/lib/registry
–ë–µ–∑ —ç—Ç–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
–í—Å–µ –æ–±—Ä–∞–∑—ã —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ üö´
Registry —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º

3. üìç –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –Ω–æ–¥–µ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ)
--constraint node.labels.registry==true
–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:
–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ
–ò–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–±–ª–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
–ü—Ä–æ—â–µ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã

‚ö° –ü—Ä–æ–±–ª–µ–º—ã Stateful —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Swarm:

–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

# ‚ùå –ü–†–û–ë–õ–ï–ú–ê - –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
docker service scale registry=3
# –ö–∞–∂–¥–∞—è —Ä–µ–ø–ª–∏–∫–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –†–ê–ó–ù–´–ï –¥–∞–Ω–Ω—ã–µ!
–†–µ—à–µ–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
# ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
--mount type=volume,source=registry-data,destination=/var/lib/registry
# –ò–ª–∏ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (NFS, Ceph, etc)

üõ†Ô∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Stateful —Å–µ—Ä–≤–∏—Å–æ–≤:

1. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ üíæ
# –ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö registry
tar -czf registry-backup.tar.gz /home/vagrant/registry/

2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ üìä
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
df -h /home/vagrant/registry/

3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ ‚öñÔ∏è
--limit-memory 1G
--reserve-memory 512M

üéØ Best Practices –¥–ª—è Stateful —Å–µ—Ä–≤–∏—Å–æ–≤:

–•—Ä–∞–Ω–∏–ª–∏—â–µ:

# –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å volumes
--mount type=volume,source=registry-vol,destination=/var/lib/registry

# –ò–ª–∏ –≤–Ω–µ—à–Ω–∏–µ storage drivers (S3, etc)

–†–∞–∑–º–µ—â–µ–Ω–∏–µ:

# –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–æ–¥–∞—Ö
--constraint node.labels.registry_storage==true

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å placement preferences
--placement-pref 'spread=node.labels.zone'

–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ:

# –†–µ–ø–ª–∏–∫–∏ —Ç–æ–ª—å–∫–æ —Å –æ–±—â–∏–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
--replicas 1  # –î–ª—è standalone
# –ò–ª–∏
--mode global  # –ü–æ –æ–¥–Ω–æ–π –Ω–∞ –Ω–æ–¥—É —Å –æ–±—â–∏–º storage
üíé –ò—Ç–æ–≥ –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞:
Registry = Stateful —Å–µ—Ä–≤–∏—Å –ø–æ—Ç–æ–º—É —á—Ç–æ:

üíæ –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ (–æ–±—Ä–∞–∑—ã)
üìç –ü—Ä–∏–≤—è–∑–∞–Ω –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É
üîÑ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
‚ö†Ô∏è –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Stateful —Å–µ—Ä–≤–∏—Å–∞! ‚úÖ
–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥–µ üéØ
Bind mount –¥–ª—è –¥–∞–Ω–Ω—ã—Ö üíæ
–û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä ‚öñÔ∏è
–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è stateful-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Swarm! üê≥‚ú®

'''
--placement-pref 'spread=node.labels.zone' =
"–†–∞—Å–ø—Ä–µ–¥–µ–ª—è–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ —Ä–∞–∑–Ω—ã–º –∑–æ–Ω–∞–º" üîÑüåç

–û—Ç–ª–∏—á–∏–µ –æ—Ç constraints:

constraints = üéØ –§–ò–õ–¨–¢–†–£–ï–¢ –≥–¥–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å

placement-pref = üîÑ –û–ü–¢–ò–ú–ò–ó–ò–†–£–ï–¢ –∫–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏

–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è: –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤, API, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ‚Äî –≥–¥–µ –Ω—É–∂–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å! ‚ö°üõ°Ô∏è
'''

# –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ ghcr.io –∏—Å–ø–æ–ª—å–∑—É—è GitHub —Ç–æ–∫–µ–Ω
echo $GH_TOKEN | docker login ghcr.io -u USERNAME --password-stdin
______________________________________
______________________________________
______________________________________
______________________________________
______________________________________








